{% extends 'base.html' %}
{% block content %}

<p>You have:</p>

<canvas id="levelbarchart"></canvas>
{% for entry in category_levels %}
You're level {{ entry.level_number }} in {{ entry.point_category }} with {{ entry.user_total_points }} points! <br>

{% endfor %}

<p>Your progress over time :)</p>
<canvas id="progressChart"></canvas>

<br><br>

{% for video in videos %}
{{ video.user_id }}

Added:
 {{ video.date_uploaded.strftime("%A") }} at {{ video.date_uploaded.strftime("%I") }}:{{ video.date_uploaded.strftime("%M") }}

<div class='videos'>
<br>
{% for object in video.video_challenge %}
Challenge: <a href="challenge/{{ object.challenge_name }}">{{ object.challenge_name }}</a>
<br>
{% endfor %}

{% for tag in video.video_tag %}
<span class='tag'>{{ tag.tag_name }}!</span>
{% endfor %}
<br>

<video width="320" height="240" controls>
	<source src="/static/uploads/{{ video.filename }}" type="video/{{ video.filename.rsplit('.', 1)[1] }}">

	Your browser doesn't support videos. Consider upgrading to a newer version.

	{{ video.video_point_totals}}

</video>
<br>
<a href="/video-upload/{{ video.filename }}">Details!</a><br>
</div>

{% for entry in video.video_point_totals %}
	{% if entry.point_category != 'completion' %}

		 <span id='{{ entry.point_category }}_{{ video.video_id }}_score'>{{ entry.total_points }} </span>

		<button class ='{{ entry.point_category }}' id='{{ entry.point_category }}_{{ video.video_id }}' disabled>{{ entry.point_category }} 
		</button>

	{% endif %}
{% endfor %}
	<br><br><br>

{% endfor %}

<script src="/static/js/levelChart.js"></script>

<script type="text/javascript">
function getData() {
	console.log("getting data");
	$.get('/progress-chart', makeProgressChart);
}

getData()

function makeProgressChart(result) {
	console.log("results are", result);
	let categories = Object.keys(result)
	console.log('categories are', categories)
	let datamap = {}
	let j;
	for (j=0; j < categories.length; j++) {
		let i;
		let category = categories[j]
		console.log('category is currently', category)
		let categoryarray = [];
		for (i = 0; i < result[category].length; i++) {
			categoryarray.push({'x': new Date(result[category][i]), 'y':(i+1)});
			// categoryarray.push(new Date(result[category][i]))
			if (categoryarray.length == result[category].length) {
				datamap[category] = categoryarray
			}
		};
	};
	console.log('enthusiasm data is ', datamap['enthusiasm']);
	let enthusiasmTimes = [];
	for (j=0; j< datamap['enthusiasm'].length; j++) {
		enthusiasmTimes.push(new Date(datamap['enthusiasm'][0]))
	};
	console.log('enthusiasm times are', enthusiasmTimes);

	let ctx = document.getElementById('progressChart').getContext('2d');
	let chart = new Chart(ctx, {
//     // The type of chart we want to create
    type: 'line',

    // The data for our dataset
    data: {
    	labels: enthusiasmTimes,
        datasets: [{
            label: "enthusiasm",
            // backgroundColor: 'rgb(52, 73, 94)',
            borderColor: 'rgb(52, 73, 94)',
            data: datamap['enthusiasm'],
        }]
        // {
        //     label: "silliness",
        //     // backgroundColor: 'rgb(110, 44, 0)',
        //     borderColor: 'rgb(110, 44, 0)',
        //     data: datamap['silliness'],
        // },
        // {
        //     label: "artistry",
        //     // backgroundColor: 'rgb(14, 102, 85)',
        //     borderColor: 'rgb(14, 102, 85)',
        //     data: datamap['artistry'],
        // },
        // {
        //     label: "originality",
        //     // backgroundColor: 'rgb(21, 67, 96)',
        //     borderColor: 'rgb(21, 67, 96)',
        //     data: datamap['originality'],
        // }
        // ]
    },

    // Configuration options go here
    options: {
    	// backgroundColor:
    }
});
// 	let chart = new Chart(ctx, {
//     // The type of chart we want to create
//     type: 'scatter',

//     // The data for our dataset
//     data: {
//         labels: 'times',
//         datasets: [
//         {
//             label: "enthusiasm",
//             backgroundColor: 'rgb(52, 73, 94)',
//             borderColor: 'rgb(52, 73, 94)',
//             data: datamap['enthusiasm'],
//         },
//         {
//             label: "silliness",
//             backgroundColor: 'rgb(110, 44, 0)',
//             borderColor: 'rgb(110, 44, 0)',
//             data: datamap['silliness'],
//         },
//         {
//             label: "artistry",
//             backgroundColor: 'rgb(14, 102, 85)',
//             borderColor: 'rgb(14, 102, 85)',
//             data: datamap['artistry'],
//         },
//         {
//             label: "originality",
//             backgroundColor: 'rgb(21, 67, 96)',
//             borderColor: 'rgb(21, 67, 96)',
//             data: datamap['originality'],
//         }
//         ]
//     },

//     // Configuration options go here
//     options: {}
// });
}
</script>

{% endblock %}