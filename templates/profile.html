{% extends 'base.html' %}
{% block content %}


<p>You have:</p>

<canvas id="myChart"></canvas>
{% for entry in category_levels %}
You have level {{ entry.level_number }} in {{ entry.point_category }} with {{ entry.user_total_points }} points! <br>

{% endfor %}

<br><br>

{% for video in videos %}

Added:
 {{ video.date_uploaded.strftime("%A") }} at {{ video.date_uploaded.strftime("%I") }}:{{ video.date_uploaded.strftime("%M") }}

<div class='videos'>
<br>
{% for object in video.video_challenge %}
Challenge: <a href="challenge/{{ object.challenge_name }}">{{ object.challenge_name }}</a>
<br>
{% endfor %}

{% for tag in video.video_tag %}
<span class='tag'>{{ tag.tag_name }}!</span>
{% endfor %}
<br>

<video width="320" height="240" controls>
	<source src="/static/uploads/{{ video.filename }}" type="video/{{ video.filename.rsplit('.', 1)[1] }}">

	Your browser doesn't support videos. Consider upgrading to a newer version.

	{{ video.video_point_totals}}

</video>
<br>
<a href="/video-upload/{{ video.filename }}">Details!</a><br>
</div>

{% for entry in video.video_point_totals %}
	{% if entry.point_category != 'completion' %}

		 <span id='{{ entry.point_category }}_{{ video.video_id }}_score'>{{ entry.total_points }} </span>

		<button class ='{{ entry.point_category }}' id='{{ entry.point_category }}_{{ video.video_id }}' disabled>{{ entry.point_category }} 
		</button>

	{% endif %}
{% endfor %}
	<br><br><br>

{% endfor %}

<script type="text/javascript">

getData();

function getData() {
	$.get('/point-chart', makeChart);
}


function makeChart(result){
	let chartLabels = Object.keys(result);
	let finishedPointValues = [result['originality'][0], result['silliness'][0], result['artistry'][0], result['completion'][0], result['enthusiasm'][0], result['social'][0]];
	let unfinishedPointValues = [result['originality'][1], result['silliness'][1], result['artistry'][1], result['completion'][1], result['enthusiasm'][1], result['social'][1]];

	let ctx = document.getElementById('myChart').getContext('2d');
	let chart = new Chart(ctx, {
	    // The type of chart we want to create
	    type: 'bar',

	    // The data for our dataset
	    data: {
	        labels: chartLabels,
	        datasets: [{
	            label: "Completed Levels",
	            backgroundColor: 'rgb(255, 99, 132)',
	            borderColor: 'rgb(255, 99, 132)',
	            data: finishedPointValues,
	        },

	        {
	            label: "Incomplete Levels",
	            backgroundColor: 'rgb(83, 189, 184)',
	            borderColor: 'rgb(83, 189, 184)',
	            data: unfinishedPointValues,
	        }]
	    },

	    // Configuration options go here
	    options: {
        scales: {
            xAxes: [{
                stacked: true
            }],
            yAxes: [{
                stacked: true
            }]
        }
    }
	});
	}
</script>

{% endblock %}