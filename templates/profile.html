{% extends 'base.html' %}
{% block content %}

<p>You have:</p>

<canvas id="levelbarchart"></canvas>
{% for entry in category_levels %}
You're level {{ entry.level_number }} in {{ entry.point_category }} with {{ entry.user_total_points }} points! <br>

{% endfor %}

<p>Your progress over time :)</p>
<canvas id="progressChart"></canvas>

<br><br>

{% for video in videos %}
{{ video.user_id }}

Added:
 {{ video.date_uploaded.strftime("%A") }} at {{ video.date_uploaded.strftime("%I") }}:{{ video.date_uploaded.strftime("%M") }}

<div class='videos'>
<br>
{% for object in video.video_challenge %}
Challenge: <a href="challenge/{{ object.challenge_name }}">{{ object.challenge_name }}</a>
<br>
{% endfor %}

{% for tag in video.video_tag %}
<span class='tag'>{{ tag.tag_name }}!</span>
{% endfor %}
<br>

<video width="320" height="240" controls>
	<source src="/static/uploads/{{ video.filename }}" type="video/{{ video.filename.rsplit('.', 1)[1] }}">

	Your browser doesn't support videos. Consider upgrading to a newer version.

	{{ video.video_point_totals}}

</video>
<br>
<a href="/video-upload/{{ video.filename }}">Details!</a><br>
</div>

{% for entry in video.video_point_totals %}
	{% if entry.point_category != 'completion' %}

		 <span id='{{ entry.point_category }}_{{ video.video_id }}_score'>{{ entry.total_points }} </span>

		<button class ='{{ entry.point_category }}' id='{{ entry.point_category }}_{{ video.video_id }}' disabled>{{ entry.point_category }} 
		</button>

	{% endif %}
{% endfor %}
	<br><br><br>

{% endfor %}

<script src="/static/js/levelChart.js"></script>

<script type="text/javascript">
function getData() {
	console.log("getting data");
	$.get('/progress-chart', makeProgressChart);
}

getData()

function makeProgressChart(result) {
	console.log("results are", result);
	let i;
	let times = [];
	for (i = 0; i < result['enthusiasm'].length; i++) {
		times.push(result['enthusiasm'][i][0])
	};
	console.log('times are', times)
	// let p;
	let points = [];
	for (i = 0; i < result['enthusiasm'].length; i++) {
		points.push(i+1)
	};
	console.log('points are', points)

	let dataPoints = []
	for (i = 0; i < result['enthusiasm'].length; i++) {
		dataPoints.push({'x': new Date(result['enthusiasm'][i][0]), 'y':(i+1)})
	};
	console.log('dataPoints are', dataPoints);

	let ctx = document.getElementById('progressChart').getContext('2d');
	let chart = new Chart(ctx, {
    // The type of chart we want to create
    type: 'scatter',

    // The data for our dataset
    data: {
        labels: times,
        datasets: [{
            label: "enthusiasm",
            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'rgb(255, 99, 132)',
            data: dataPoints,
        }]
    },

    // Configuration options go here
    options: {}
});
}
</script>

{% endblock %}